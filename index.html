<!DOCTYPE html>
<html>
<head>
<title>TMDB demo for Global Gaming</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Special+Elite">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/jquery.dataTables.min.css">
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.dataTables.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<style>

	body{font-family:'Special Elite';font-size:1.5em}
	input{height:27px}
	button{margin-right:22px}
	table{width:100%}
	.nowrap{white-space:nowrap;}
	.text-center{text-align:center}
	#tmdb_table{display:none} 

</style>
</head>
<body>

	<div id="container">

		<div class="row">
			<div class="col-md-3"></div>
			<div class="col-md-6 text-center">
				<h2>TMDB demo for Global Gaming</h2>
				<h4>Delivered by Kristoffer Hell</h4>
			</div>	
			<div class="col-md-3"></div>
		</div>	

		<div class="row">
			<div class="col-md-1"></div>
			<div class="col-md-2 nowrap text-center">	
				Search for title: 
			</div>	
			<div class="col-md-3 nowrap  text-center">	
				<input id="title_input" type="text" /><button id="title_btn">go</button>
			</div>	
			<div class="col-md-2 nowrap text-center">	
				Discover by genre: 
			</div>	
			<div class="col-md-3 nowrap text-center">	
				<input id="genre_input" type="text" /><button id="genre_btn">go</button>
			</div>
			<div class="col-md-1"></div>
		</div>	

		<div class="row"><div class="col-md-12"><p>&nbsp;</p></div></div>

		<div class="row">
			<div class="col-md-2"></div>
			<div class="col-md-8" id='$tmdb_table_container'>

				<table id="tmdb_table" class="display"></table>

			</div>
			<div class="col-md-2"></div>
		</div>		

	</div>	

<div id="flix_dialog" style="display:none" title="Flix">Test</div>


<script>

var myTMDBKey = 'fb3a898f7095987835b1b2d87249cefb',
	imgRoot = 'http://image.tmdb.org/t/p/',
	maxAllowedHits = 400,
	flix = [],
	flixCompl = [],
	tmdbTable = ''	

$(document).ready(function() {

	$('body').keydown(function(e) {
		if (e.key == 'Enter' && $('#title_input').is(':focus')) {
			$('#title_btn').click()
		}
		if (e.key == 'Enter' && $('#genre_input').is(':focus')) {
			$('#genre_btn').click()
		}
	})

/*	$('#title_input').focus(function() {
		if ($.fn.DataTable.isDataTable('#tmpdb_table')) {
			$("#tmdb_table").destroy()
		}
	})
*/
	$('#tmdb_table').on('click','a',function (e) {
		alert(e)
	})

	$('#title_btn').click(function(e) {
		var input = $('#title_input').val(),
			pages = 0,
			hits = 0,
			url ='https://api.themoviedb.org/3/search/movie?query='+input+'&api_key='+myTMDBKey

		flix = []
		flixCompl = []
		
//		$.fn.dataTable.ext.errMode = 'none'

		if ($.fn.DataTable.isDataTable('#tmdb_table')) {
			tmdbTable.destroy()
		}

		$.get(url,function(data, status) {
			pages = data.total_pages+1
			hits  = data.total_results
			if (hits > maxAllowedHits) {
				alert('Search aborted. Over '+maxAllowedHits+' results returned. Try to narrow your search by being more specific.')
			} else {
				let len = data.results.length
				while (len--) {
					flix.push([
						data.results[len].id, 
						'<a href="#'+data.results[len].id+'">'+data.results[len].title+'</a>', 
						data.results[len].genre_ids, 
						data.results[len].release_date,
						data.results[len].vote_average
					])
					flixCompl[data.results[len].id] = [
						data.results[len].poster_path,
						data.results[len].overview,
						data.results[len].genre_ids,
						data.results[len].release_date
					]
				}
				$('#tmdb_table').show()
				tmdbTable = $('#tmdb_table').DataTable( {
					data: flix,
					columns: [
						{ title: "Id" },
				        { title: "Title" },
				        { title: "Genre" },
				        { title: "Release Date" },
				        { title: "Avg Vote" }
					]
				})					
				console.log(flixCompl)
			}		

		})	
			
	})

})

</script>
</body>
</html>

